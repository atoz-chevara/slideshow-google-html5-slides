<div class="slide transitionSlide" id="hardware-access-title">
  <section class="middle">
    <h2>File / Hardware Access</h2>
    <p>Deeper integration with the Operating System</p>
    <img src="http://www.html5rocks.com/static/images/identity/classes_64/HTML5_Device_Access_64.png" title="HTML5 Device Access" alt="HTML5 Device Access">
  </section>
</div>


<div class="slide device-access" id="native-drag-and-drop">
  <header><span class="js">JS</span> <h1>Native Drag &amp; Drop</h1></header>
  <section id="dnd-section">
<pre>document.addEventListener(<em>'dragstart'</em>, function(event) {
event.<b>dataTransfer.setData</b>('text', 'Customized text');
event.<b>dataTransfer.effectAllowed</b> = 'copy';
}, false);
</pre>
    <ol id="drag-zone">
      <li><img src="src/dwd1.png" draggable class="copy" /></li>
      <li><span class="draggable-text" draggable>Select text and drag (original text will be dropped)</span></li>
      <li><span class="draggable-text" draggable class="overwrite">Select text and drag (dragged text data will be altered from original)</span></li>
    </ol>
    <div id="drop-data">Source Data</div>
    <div id="drop-zone">Drop Area</div>
    <script defer>
    (function() {
      var dragZone = document.querySelector('#drag-zone');
      var dropZone = document.querySelector('#drop-zone');
      dragZone.addEventListener('dragstart', function(event) {
        if (event.target.className) { // img case
          event.dataTransfer.effectAllowed = event.target.className;
          event.target.style.border = "4px solid #cc3300";
        }
        else { // text case
          if (event.target.parentNode.className == 'overwrite') {
            event.dataTransfer.setData("text", "<strong>Overwritten Content</strong>");
          }
          event.target.parentNode.style.border = "4px solid #cc3300";
        }
        return true;
      }, true);
      dragZone.addEventListener('dragend', function(event) {
        if (event.target.className) { // img case
          event.target.style.border = "4px solid #888";
        }
        else { // text case
          event.target.parentNode.style.border = "4px solid #888";
        }
        return true;
      }, true);
      dropZone.addEventListener('dragenter', function(event) {
        if (event.preventDefault) event.preventDefault();
        event.dataTransfer.dropEffect = 'copy';
        this.className = 'hovering';
        return false;
      }, false);
      dropZone.addEventListener('dragover', function(event) {
        if (event.preventDefault) event.preventDefault(); // allows us to drop
        event.dataTransfer.dropEffect = 'copy';
        return false;
      }, false);
      dropZone.addEventListener('dragleave', function(event) {
        if (event.preventDefault) event.preventDefault(); // allows us to drop
        this.className = '';
        return false;
      }, false);
      dropZone.addEventListener('drop', function(event) {
        if (event.preventDefault) event.preventDefault();
        var imgPassed = null;
        var dropdata = document.querySelector('#drop-data');
        var types = event.dataTransfer.types;
        document.querySelector('#drop-data').textContent = '';
        this.innerHTML = '';
        for (var i = 0; i < types.length; i++) {
          if (types[i] == 'Files') {
            var files = event.dataTransfer.files;
            for (var j = 0; j < files.length; j++) {
              dropdata.textContent += 'File Name: '+files[j].fileName;
              dropdata.textContent += 'File Size: '+files[j].fileSize;
            }
          }
          else {
            if (typeof event.dataTransfer.getData(types[i]) !== 'undefined') {
              dropdata.innerHTML += '<p><em class="datatypes">'+types[i]+'</em>: <br />'+event.dataTransfer.getData(types[i]).replace(/</g, '&lt;') + '</p>';
            }
          }

          if (types[i] == 'text/uri-list') {
            imgPassed = event.dataTransfer.getData('text/uri-list');
          }
        }
        if (imgPassed) {
          var cEl = document.createElement('canvas');
          cEl.width = 200;
          cEl.height = 100;
          var ctx = cEl.getContext('2d');
          var img_buffer = document.createElement('img');
          img_buffer.src = imgPassed;
          img_buffer.style.display = 'none';
          document.body.appendChild(img_buffer); // this line only needed in safari
          img_buffer.onload = function() { ctx.drawImage(img_buffer,0,0,100,100); }
          this.appendChild(cEl);
        } else {
          if (event.dataTransfer.getData('text')) {
            this.innerHTML = event.dataTransfer.getData('text');
          }
          else if (event.dataTransfer.getData('text/plain')) {
            this.innerHTML = event.dataTransfer.getData('text/plain');
          }
        }
        return false;
      }, false);
    })();
    </script>
  </section>
</div>


<div class="slide device-access" id="desktop-drag-in">
  <header><span class="js">JS</span> <h1>Desktop Drag-In (File API)</h1></header>
  <section>
<h3>Drag files in from the desktop:</h3>
<pre>
document.querySelector('#dropzone').addEventListener('drop', function(e) {
var reader = new <b>FileReader</b>();
reader.onload = function(evt) {
document.querySelector('img').src = evt.target.<b>result</b>;
};

reader.<b>readAsDataURL</b>(e.<b>dataTransfer.files[0]</b>);
}, false);
</pre>
    <div class="example">
      <div id="dropzone" class="vbox boxcenter center">
        Drop in images from your desktop
      </div>
    </div>
    <div id="dnd-thumbnails" class="center"></div>

    <script src="src/dnd/dnd-lib.js" defer></script>
    <script defer>
      window.addEventListener('load', function(e) {
        var dndc = new DNDFileController('dropzone', 'dnd-thumbnails');
      }, false);
    </script>
  </section>
</div>


<div class="slide device-access" id="desktop-drag-out">
  <header><span class="js">JS</span> <h1>Desktop Drag-Out</h1></header>
  <section id="dnd-section">

    <h3>Drag files out onto the desktop:</h3>

    <pre>
&lt;a href="src/star.mp3" draggable="true" class="dragout"
data-downloadurl="<b>MIMETYPE:FILENAME:ABSOLUTE_URI_TO_FILE</b>"&gt;download&lt;/a&gt;
</pre>

    <pre>
var files = document.querySelectorAll('.dragout');
for (var i = 0, file; file = files[i]; ++i) {
file.addEventListener('dragstart', function(e) {
e.dataTransfer.setData('DownloadURL', this.dataset.downloadurl);
}, false);
}
</pre>

    <div class="example">
      Drag each of these files onto your desktop:
      <a href="http://static.googleusercontent.com/external_content/untrusted_dlcp/www.google.com/en/us/intl/en/landing/chrome/cadie/glasses.pdf" class="dragout" data-downloadurl="application/pdf:Chrome3DGlasses.pdf:http://static.googleusercontent.com/external_content/untrusted_dlcp/www.google.com/en/us/intl/en/landing/chrome/cadie/glasses.pdf">.pdf file</a>
      <a href="src/star.mp3" class="dragout" data-downloadurl="audio/mpeg:star.mp3:http://slides.html5rocks.com/src/star.mp3">.mp3 file</a>
    </div>
    <p class="center" style="font-size:90%">( this feature is only available in Google Chrome )</p>
    <script defer>
      (function() {
        var files = document.querySelectorAll('.dragout');
        for (var i = 0, file; file = files[i]; ++i) {
          file.setAttribute('draggable', 'true'); // Don't really need, but good practice.
          file.addEventListener('dragstart', function(evt) {
            evt.dataTransfer.setData('DownloadURL', this.getAttribute('data-downloadurl'));
          }, false);
        }
      })();
    </script>
  </section>
</div>


<div class="slide device-access" id="filewriter">
  <header><span class="js">JS</span> <h1>FileSystem APIs</h1></header>
  <section>

    <h3>Asynchronously write a file to a sandboxed file system using JavaScript:</h3>

    <pre>
<b>window.requestFileSystem</b>(<b>window.TEMPORARY</b>, 1024 * 1024, function(fs) {

// fs.root is a DirectoryEntry object.
<b>fs.root.getFile</b>('log.txt', {create: true}, function(fileEntry) {

<b>fileEntry.createWriter</b>(function(writer) {  // writer is a FileWriter object.

<b>writer.onwrite</b> = function(e) { ... };
<b>writer.onerror</b> = function(e) { ... };

var bb = new BlobBuilder();
bb.append('Hello World!');

<b>writer.write</b>(bb.getBlob('text/plain'));

}, opt_errorHandler);
}

}, opt_errorHandler);
</pre>
    <p class="center" style="font-size:90%">( The FileSystem API is currently only implemented in Google Chrome 9+ )</p>
  </section>
</div>


<div class="slide device-access" id="geolocation">
  <header><span class="js">JS</span> <h1>Geolocation</h1></header>
  <section>
<pre>if (<b>navigator</b>.<b>geolocation</b>) {
<b>navigator</b>.<b>geolocation</b>.<b>getCurrentPosition</b>(function(position) {
var latLng = new google.maps.LatLng(
position.<b>coords</b>.<b>latitude</b>, position.<b>coords</b>.<b>longitude</b>);
var marker = new google.maps.Marker({position: latLng, map: map});
map.setCenter(latLng);
}, errorHandler);
}
</pre>
  <button id="see-position">Show Position</button> <span id="geo-log"></span>
  <div id="geo-map" class="gmap example">
    <img src="http://maps.google.com/maps/api/staticmap?center=37.4419,-94.1419&zoom=3&size=680x278&sensor=true"/>
  </div>

  <script defer>
  (function() {
    var map = null;
    var geolog = document.querySelector('#geo-log');
    var geoMap = document.querySelector('#geo-map');

    function showPosition(position) {
      geolog.textContent = "You're within " + position.coords.accuracy +
          " meters of (" + position.coords.latitude + ", " +
          position.coords.longitude + ")";
      var latLng = new google.maps.LatLng(
          position.coords.latitude, position.coords.longitude);
      var marker = new google.maps.Marker({
        position: latLng,
        map: map
      });
      map.setCenter(latLng);
      map.setZoom(15);
    }

    function handlePositionError(evt) {
      geolog.textContent = evt.message;
    }

    function successPositionHandler(evt) {
      // Load map if it doesn't already exist and when user clicks the button.
      if (!map) {
        map = new google.maps.Map(geoMap, {
          zoom: 3,
          center: new google.maps.LatLng(37.4419, -94.1419), // United States
          mapTypeId: google.maps.MapTypeId.ROADMAP
        });
        map.getDiv().style.border =  '1px solid #ccc';
      }

      if (navigator.geolocation) {
        geolog.style.visibility = 'visible';
        geolog.textContent = 'Looking for location...';
        navigator.geolocation.getCurrentPosition(showPosition, handlePositionError);
        // Also monitor position as it changes.
        //navigator.geolocation.watchPosition(showPosition, handlePositionError);
      } else {
        geolog.textContent = 'Oops! Your browser does not support geolocation.';
      }
    }

    document.querySelector('#see-position').addEventListener('click', successPositionHandler, false);
    geoMap.addEventListener('click', successPositionHandler, false);
  })();
  </script>
  </section>
</div>


<div class="slide device-access" id="slide-orientation" onload="os.onload();" onunload="os.onunload();">
  <header><span class="js">JS</span> <h1>Device Orientation</h1></header>
  <section>
    <pre>
window.addEventListener('<em>deviceorientation</em>', function(event) {
var a = event.<b>alpha</b>;
var b = event.<b>beta</b>;
var g = event.<b>gamma</b>;
}, false);
</pre>
  <p>This sample requires FF3.6+ or Google Chrome
  on a device with a built in accelerometer or iOS 4.2.</p>
  <div class="flex hbox boxcenter">
    <div id="orientationWrap" class="noflex vbox boxcenter">
      <div class="layer"><img src="src/orientation/chrome-layer-01.png"/></div>
      <div class="layer"><img src="src/orientation/chrome-layer-02.png"/></div>
      <div class="layer"><img src="src/orientation/chrome-layer-03.png"/></div>
      <div class="layer"><img src="src/orientation/chrome-layer-04.png"/></div>
      <div class="layer"><img src="src/orientation/chrome-layer-05.png"/></div>
    </div>
  </div>
  <script defer>
    function OrientationSlide(slide) {
      this._slide = document.querySelector(slide);
      this._lastBeta = 0;
      this._lastGamma = 0;
    }
    OrientationSlide.prototype.orientationListener = function(evt) {
      // For FF3.6+
      if (!evt.gamma && !evt.beta) {
        evt.gamma = -(evt.x * (180 / Math.PI));
        evt.beta = -(evt.y * (180 / Math.PI));
      }

      var overThreshold = Math.abs(evt.gamma) > 4 || Math.abs(evt.beta) > 4;
      var gamma = overThreshold ? evt.gamma : 0;
      var beta = overThreshold ? evt.beta : 0;

      if (this._lastGamma != gamma || this._lastBeta != beta) {
        var zindex = 0;
        var layers = document.querySelectorAll('.layer');
        for (var i = 0, elem; elem = layers[i]; ++i) {
          zindex++;
          var x = Math.round(1.5 * gamma * zindex);
          var y = Math.round(1.5 * beta * zindex);
          var style = elem.style;
          style.left = x.toString() + 'px';
          style.top = y.toString() + 'px';
          style.webkitTransform = 'rotateY(' + (-2.0 * gamma) + 'deg) rotateX(' + (-2.0 * beta) + 'deg)';
          style.MozTransform = 'rotateY(' + (-2.0 * gamma) + 'deg) rotateX(' + (-2.0 * beta) + 'deg)';
        }
        this._lastGamma = gamma;
        this._lastBeta = beta;
      }
    };
    OrientationSlide.prototype.onunload = function(evt) {
      window.removeEventListener('deviceorientation', this.orientationListener, false);
      window.removeEventListener('MozOrientation', this.orientationListener, false);
    };
    OrientationSlide.prototype.onload = function(evt) {
      window.addEventListener('deviceorientation', this.orientationListener, false);
      window.addEventListener('MozOrientation', this.orientationListener, false);
    };
    var os = new OrientationSlide('#slide-orientation');

    if (!('ondeviceorientation' in window) &&
        !(window.onmozorientation)) {
      document.querySelector('#slide-orientation p').style.display = 'block';
    }
  </script>
  </section>
</div>

<div class="slide device-access" id="speech-input">
  <header><span class="html">HTML</span> <h1>Speech Input</h1></header>
  <section>

    <pre>&lt;input type="text" <b>x-webkit-speech</b> /&gt;</pre>

    <div class="flex hbox boxcenter">
      <div class="noflex vbox boxcenter" style="height:300px;text-align:center">
       <input id="speech-input-field" type="text" x-webkit-speech />
       <p style="display:none">Speech input is not enabled in your browser.<br>
       Try running Google Chrome with the <code>--enable-speech-input</code> flag.</p>
      </div>
    </div>
    <script>
      if (!('webkitSpeech' in document.createElement('input'))) {
        document.querySelector('#speech-input p').style.display = 'block';
      }
    </script>
  </section>
</div>
